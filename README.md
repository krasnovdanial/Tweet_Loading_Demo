# ETL-процесс для анализа твитов

## 1. Источник данных

- Входящие файлы в формате JSON (tweet.json), поступающие на FTP каждые 3 минуты.
- Размер файлов в 10 раз больше тестового примера.

## 2. Extract (извлечение)

- Автоматическая загрузка файлов с FTP.
- Возможные инструменты: `wget`, `curl`, Python-библиотеки `ftplib`.
- Сценарий запускается по расписанию (cron, Airflow, Luigi).

## 3. Transform (трансформация)

1. **Парсинг JSON**:
    - Чтение построчно.
    - Пропуск записей с пометкой `delete`.

2. **Нормализация структуры**:
    - Таблица `users` (user_id, name, location).
    - Таблица `tweets` (tweet_id, user_id, tweet_text, created_at, lang, tweet_sentiment).
    - Таблица `countries` (country_code, country_name).
    - Таблица `urls` (display_url).

3. **Вычисление sentiment**:
    - Используем словарь AFINN-111.
    - Каждому слову присвоен вес (-5 до +5).
    - Для каждого твита считаем сумму весов найденных слов.
    - Если слов нет — sentiment = 0.

4. **Очистка данных**:
    - Удаление дубликатов.
    - Пропуск пустых текстов.
    - Приведение кодировок и форматов времени.

## 4. Load (загрузка)

- Запись результатов в хранилище данных.
- Для учебного примера — SQLite.
- Для промышленного решения — PostgreSQL или ClickHouse.

## 5. Аналитика и отчёты

1. SQL-запросы:
    - Определение самой счастливой/несчастной страны.
    - Определение самой счастливой/несчастной локации.
    - Определение самого счастливого/несчастного пользователя с его твитами.

2. BI-инструменты:
    - Tableau, Power BI, Grafana.
    - Визуализация динамики счастья по странам, локациям, пользователям.

## 6. Автоматизация

- Планировщик (cron) или Airflow DAG:
    - load_tweets — загрузка данных.
    - normalize — нормализация.
    - calculate_sentiment — обновление тональности.
- DAG можно запускать каждые 3 минуты или раз в сутки (для агрегации).

## 7. Итоговая схема решения

- **FTP → Extract (Python-скрипты) → Transform (нормализация + sentiment) → Load (БД)**
- **База данных → SQL-запросы / BI-инструменты → Пользователи получают аналитику**

## 8. Преимущества

- Масштабируемость: легко перейти с SQLite на PostgreSQL.
- Автоматизация: Airflow/Luigi для управления процессом.
- Гибкость: легко добавить новые метрики (например, топ-хэштеги или ретвиты).